"""
Generated DAG: pipeline__eng_youtube_transfer

================================================================================
ğŸ‘¶ ì–´ë¦°ì´ë¥¼ ìœ„í•œ 100% ì´í•´ ê°€ëŠ¥ ì„¤ëª…ì„œ (Kindergarten Guide) ğŸ‘¶
================================================================================

ì•ˆë…•! ì´ íŒŒì¼ì€ "DAG(ëŒ)"ì´ë¼ê³  ë¶ˆëŸ¬ìš”.
ë¡œë´‡ ì¹œêµ¬ë“¤ì—ê²Œ "ì–´ë–¤ ì¼ì„, ì–´ë–¤ ìˆœì„œë¡œ í•´ì•¼ í•´!"ë¼ê³  ì•Œë ¤ì£¼ëŠ” *ë³´ë¬¼ ì§€ë„* ê°™ì€ ê±°ì˜ˆìš”.

ìš°ë¦¬ê°€ í•˜ë ¤ëŠ” ì¼ì€ ë‘ ê°€ì§€ì˜ˆìš”:
1. ìœ íŠœë¸Œì—ì„œ ìƒˆë¡œìš´ ì˜ìƒì„ ì°¾ì•„ì˜¤ê¸° (fetch_videos)
2. ê°€ì¥ ìµœì‹  ì˜ìƒì„ ê°€ì ¸ì™€ì„œ ìš”ì•½í•˜ê¸° (process_latest_video)

ì, ì´ì œ ì½”ë“œë¥¼ í•˜ë‚˜ì”© ì‚´í´ë³¼ê¹Œìš”?
"""

from airflow import DAG
import pendulum
from datetime import datetime, timedelta

# ==============================================================================
# 1. ë„êµ¬ ìƒì (Imports)
# ==============================================================================
# ë¡œë´‡ë“¤ì´ ì¼ì„ í•˜ë ¤ë©´ ë„êµ¬ê°€ í•„ìš”í•´ìš”.
# PythonOperatorëŠ” "íŒŒì´ì¬ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë¡œë´‡ íŒ”"ì´ì—ìš”.
from airflow.providers.standard.operators.python import PythonOperator


# ==============================================================================
# 2. ê¸°ë³¸ ê·œì¹™ (Default Args)
# ==============================================================================
# ëª¨ë“  ë¡œë´‡ë“¤ì´ ì§€ì¼œì•¼ í•  ê³µí†µ ì•½ì†ì´ì—ìš”.
default_args = {
    "owner": "geon_yul",       # ì´ ì§€ë„ì˜ ì£¼ì¸ë‹˜ ì´ë¦„ì´ì—ìš”.
    "retries": 2,              # ë¡œë´‡ì´ ì‹¤ìˆ˜ë¡œ ë„˜ì–´ì§€ë©´, 2ë²ˆê¹Œì§€ëŠ” ë‹¤ì‹œ ì¼ì–´ë‚˜ì„œ ì‹œë„í•´ë³´ë¼ê³  í•´ìš”.
    "retry_delay": timedelta(seconds=300), # ë‹¤ì³¤ìœ¼ë©´ 300ì´ˆ(5ë¶„) ì •ë„ ì‰¬ì—ˆë‹¤ê°€ ë‹¤ì‹œ í•˜ë˜ìš”.
}

# ==============================================================================
# 3. ë³´ë¬¼ ì§€ë„ ê·¸ë¦¬ê¸° (Pipeline Definition)
# ==============================================================================
# with DAG(...) as dag: << ì—¬ê¸°ê°€ ë°”ë¡œ ì§€ë„ì˜ ì‹œì‘ì´ì—ìš”!
with DAG(
    dag_id="pipeline__eng_youtube_transfer", # ì§€ë„ì˜ ì´ë¦„ì´ì—ìš”. ì—ì–´í”Œë¡œìš° í™”ë©´ì— ì´ ì´ë¦„ìœ¼ë¡œ ë– ìš”.
    default_args=default_args,               # ìœ„ì—ì„œ ì •í•œ ì•½ì†ì„ ì§€í‚¤ê¸°ë¡œ í•´ìš”.
    schedule="@hourly",                      # "í•œ ì‹œê°„ë§ˆë‹¤ í•œ ë²ˆì”©" ì´ ì§€ë„ë¥¼ í¼ì³ì„œ ì¼ì„ ì‹œì‘í•´ìš”.
    catchup=False,                           # ìš°ë¦¬ê°€ ì ìê³  ìˆì„ ë•Œ ë†“ì¹œ ì¼ë“¤ì€ êµ³ì´ ë‹¤ì‹œ í•˜ì§€ ì•Šê¸°ë¡œ í•´ìš”. (ìƒˆë¡œìš´ ê²ƒë§Œ!)
    tags=[],                                 # íƒœê·¸(ê¼¬ë¦¬í‘œ)ëŠ” ë‹¬ì§€ ì•Šì•˜ì–´ìš”.
) as dag:

    # ==========================================================================
    # 4. ë¡œë´‡ ì¹œêµ¬ë“¤ ì†Œí™˜ (Task Definitions)
    # ==========================================================================

    # ì²« ë²ˆì§¸ ë¡œë´‡: ì˜ìƒ ì°¾ì•„ì˜¤ê¸° ëŒ€ì¥
    fetch_videos = PythonOperator(
        task_id="fetch_videos",  # ì´ ë¡œë´‡ì˜ ì´ë¦„í‘œì˜ˆìš”.
        
        # ì´ ë¡œë´‡ì´ í•´ì•¼ í•  ë™ì‘(í•¨ìˆ˜)ì´ì—ìš”.
        # "eng_youtube.video_ops.fetch_latest_videos" ë¼ëŠ” ì±…ì— ì íŒ ëŒ€ë¡œ í–‰ë™í•´ìš”.
        # ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ íŒŒì´ì¬ ì½”ë“œê°€ ì‹¤í–‰ë¼ìš”!
        python_callable=lambda: print(
            "Executing eng_youtube.video_ops.fetch_latest_videos"
        ),
        
        # ë¡œë´‡ì—ê²Œ ì¤„ ì¤€ë¹„ë¬¼ì´ì—ìš”. 
        # "ì´ ì±„ë„(channel_id)ì—ì„œ, ì˜ìƒ 3ê°œ(limit)ë§Œ ì°¾ì•„ì™€!" ë¼ê³  ì£¼ë¬¸ì„œë¥¼ ì¤¬ì–´ìš”.
        op_kwargs={"channel_id": "UCtoNXlIegvxkvf5Ji8S57Ag", "limit": 3},
    )

    # ë‘ ë²ˆì§¸ ë¡œë´‡: ì˜ìƒ ìš”ì•½í•˜ê¸° ëŒ€ì¥
    process_latest_video = PythonOperator(
        task_id="process_latest_video", # ì´ ë¡œë´‡ì˜ ì´ë¦„í‘œì˜ˆìš”.
        
        # "eng_youtube.video_ops.process_video_pipeline" ì±…ì— ì íŒ ëŒ€ë¡œ ì˜ìƒì„ ì²˜ë¦¬í•´ìš”.
        python_callable=lambda: print(
            "Executing eng_youtube.video_ops.process_video_pipeline"
        ),
        
        # "ì´ ë¹„ë””ì˜¤(video_12345)ë¥¼ ì²˜ë¦¬í•´!" ë¼ê³  ì•Œë ¤ì¤¬ì–´ìš”.
        # (ë‚˜ì¤‘ì—ëŠ” ì²« ë²ˆì§¸ ë¡œë´‡ì´ ì°¾ì•„ì˜¨ ë¹„ë””ì˜¤ë¥¼ ìë™ìœ¼ë¡œ ë„˜ê²¨ë°›ê²Œ ë  ê±°ì˜ˆìš”!)
        op_kwargs={"video_id": "video_12345"},
    )

    # ==========================================================================
    # 5. ìˆœì„œ ì •í•˜ê¸° (Dependencies)
    # ==========================================================================
    # ì—¬ê¸°ê°€ ì œì¼ ì¤‘ìš”í•´ìš”! ë¡œë´‡ë“¤ì´ ë™ì‹œì— ìš°ë£¨ë£¨ ë‚˜ê°€ë©´ ì—‰ë§ì´ ë˜ê² ì£ ?
    # ">>" í™”ì‚´í‘œê°€ ìˆœì„œë¥¼ ì•Œë ¤ì¤˜ìš”.
    
    # "ì˜ìƒ ì°¾ì•„ì˜¤ê¸°(fetch_videos)"ê°€ ë¨¼ì € ëë‚˜ì•¼ -> "ì˜ìƒ ìš”ì•½í•˜ê¸°(process_latest_video)"ë¥¼ ì‹œì‘í•´ìš”.
    # ë§Œì•½ ì˜ìƒì„ ëª» ì°¾ì•„ì˜¤ë©´? ìš”ì•½í•˜ëŠ” ë¡œë´‡ì€ ì‹œì‘ë„ ì•ˆ í•˜ê³  ê¸°ë‹¤ë¦´ ê±°ì˜ˆìš”.
    
    fetch_videos >> process_latest_video
